% Generated using GBSolver generator v1.1 Copyright Martin Bujnak,
% Zuzana Kukelova, Tomas Pajdla CTU Prague 2008.
% 
% Please refer to the following paper, when using this code :
%     Kukelova Z., Bujnak M., Pajdla T., Automatic Generator of Minimal Problem Solvers,
%     ECCV 2008, Marseille, France, October 12-18, 2008

function [f za zb zc zd meta M] = mbp4pfd_207_11__1ffzdzd(glab, a1, b1, c1, d1)

	% instance=mbp4pftest_inst ordering={f,za,zb,zc,zd} equations={} basis={1,f,f*zd,zd} 
	% gj = 1 subst = 1
	meta = {1,1, {'mbp4pftest_inst'}, {'f' 'za' 'zb' 'zc' 'zd'}, {}, {'1' 'f' 'f*zd' 'zd'} };

	%monomials appearing in matrix M:
	%    zb^2*za^2*f^3 zc*zb*za^2*f^3 zd*zb*za^2*f^3 zd*zb^2*za*f^3 zd*zc*za^2*f^3 zd*zc*zb*za*f^3 zd^2*za^2*f^3 zd^2*zb*za*f^3 zb^2*za^2*f^2 zc*zb*za^2*f^2 zc*zb^2*za*f^2 
	%    zc^2*za^2*f^2 zc^2*zb*za*f^2 zc^2*zb^2*f^2 zd*zb*za^2*f^2 zd*zb^2*za*f^2 zd*zc*za^2*f^2 zd*zc*zb*za*f^2 zd*zc*zb^2*f^2 zd*zc^2*za*f^2 zd*zc^2*zb*f^2 zd^2*za^2*f^2 
	%    zd^2*zb*za*f^2 zd^2*zb^2*f^2 zd^2*zc*za*f^2 zd^2*zc*zb*f^2 zd^3*za*f^2 zb^2*za^2*f zc*zb*za^2*f zc*zb^2*za*f zc^2*za^2*f zc^2*zb*za*f zc^2*zb^2*f 
	%    zd*zb*za^2*f zd*zb^2*za*f zd*zc*za^2*f zd*zc*zb*za*f zd*zc*zb^2*f zd*zc^2*za*f zd*zc^2*zb*f zd^2*za^2*f zd^2*zb*za*f zd^2*zb^2*f zd^2*zc*za*f 
	%    zd^2*zc*zb*f zd^2*zc^2*f zd^3*za*f zd^3*zb*f zd^3*zc*f zd^4*f zb*za*f^2 zb^2*f^2 zb^2*za^2 zc*za*f^2 zc*zb*f^2 
	%    zc*zb*za^2 zc*zb^2*za zc^2*za^2 zc^2*zb*za zc^2*zb^2 zd*zb*za^2 zd*zb^2*za zd*zc*za^2 zd*zc*zb*za zd*zc*zb^2 zd*zc^2*za 
	%    zd*zc^2*zb zd^2*za^2 zd^2*zb*za zd^2*zb^2 zd^2*zc*za zd^2*zc*zb zd^2*zc^2 zb*za*f zb^2*f zc*za*f zc*zb*f 
	%    zc^2*f zd*za*f zd*zb*f zd*zc*f zd^2*f za^2 zb*za zb^2 zc*za zc*zb zc^2 
	%    zd*f zd*za zd*zb zd*zc zd^2 f zd 1 
	M = zeros(92, 96);
	M([86, 177, 268, 451, 634, 793, 884, 1067, 1342, 1525, 1984, 2499, 2590, 2773, 3048, 3231, 3690]) = 1;
	M([362, 545, 728, 1437, 1620, 1803, 2078, 2261, 2444, 3143, 3326, 3509, 3784, 3967, 4242]) = -2;
	M([2173, 2356, 3879, 4062, 4153, 4336, 4427, 4518]) = 1;
	M([822, 913, 1372, 1555, 2014, 2541, 2632, 2815, 3090, 3273, 3732, 4799, 5074, 5257, 5532, 5715, 6174]) = a1(1)^2+a1(2)^2;
	M([1466, 1649, 2108, 2291, 2474, 3185, 3368, 3551, 3826, 4009, 4284, 5627, 5810, 5993, 6268, 6451]) = -2*a1(1)*d1(1)-2*a1(2)*d1(2);
	M([2202, 2385, 3921, 4104, 4195, 4378, 4469, 4560, 6363, 6546, 6637]) = d1(1)^2+d1(2)^2;
	M([4778, 5053, 6865, 7048, 7139, 7322, 7413, 7504, 7743, 7926, 8017, 8292, 8383, 8474]) = -glab(3);
	M([92, 183, 274, 365, 548, 731, 801, 892, 983, 1166, 1349, 1440, 1623, 2082, 2507, 2598, 2689, 2872, 3055, 3146, 3329, 3788, 4606, 6717]) = 1;
	M([276, 459, 642, 733, 1353, 1536, 1627, 1810, 1993, 2084, 2267, 2450, 3059, 3242, 3333, 3516, 3699, 3790, 3973, 4248, 7177]) = -1;
	M([368, 551, 734, 1445, 1628, 1719, 1902, 2085, 2176, 2359, 3151, 3334, 3425, 3608, 3791, 3882, 4065, 4340, 7269]) = -1;
	M([736, 2089, 2272, 2363, 2453, 3795, 3978, 4069, 4160, 4251, 4342, 4433, 4524, 7453]) = 1;
	M([828, 919, 1378, 1469, 1652, 2111, 2549, 2640, 2731, 2914, 3097, 3188, 3371, 3830, 4807, 5082, 5173, 5356, 5539, 5630, 5813, 6272, 6722, 7637]) = a1(1)*b1(1)+a1(2)*b1(2);
	M([1380, 1563, 2022, 2113, 2296, 2479, 3101, 3284, 3375, 3558, 3741, 3832, 4015, 4290, 5543, 5726, 5817, 6000, 6183, 6274, 6457, 7182, 8189]) = -a1(1)*d1(1)-a1(2)*d1(2);
	M([1472, 1655, 2114, 2205, 2388, 3193, 3376, 3467, 3650, 3833, 3924, 4107, 4382, 5635, 5818, 5909, 6092, 6275, 6366, 6549, 7274, 8281]) = -d1(2)*b1(2)-d1(1)*b1(1);
	M([2116, 2299, 2482, 3837, 4020, 4111, 4202, 4293, 4384, 4475, 4566, 6279, 6462, 6553, 6644, 7458, 8465]) = d1(1)^2+d1(2)^2;
	M([4692, 4967, 6781, 6964, 7055, 7146, 7237, 7328, 7419, 7510, 7659, 7842, 7933, 8024, 8207, 8298, 8389, 8480, 8562, 8741]) = -1/2*glab(3)-1/2*glab(5)+1/2*glab(1);
	M([990, 1265, 1448, 1723, 2182, 2513, 2696, 2971, 3154, 3429, 3888, 4699, 6810]) = 1;
	M([1634, 1909, 2092, 2367, 3065, 3340, 3615, 3798, 4073, 4348, 7270]) = -2;
	M([2278, 2460, 3709, 3984, 4167, 4258, 4441, 4532, 7454]) = 1;
	M([2738, 3013, 3196, 3471, 3930, 4813, 5180, 5455, 5638, 5913, 6372, 6815, 7730]) = b1(2)^2+b1(1)^2;
	M([3382, 3657, 3840, 4115, 4390, 5549, 5824, 6099, 6282, 6557, 7275, 8282]) = -2*d1(2)*b1(2)-2*d1(1)*b1(1);
	M([4026, 4209, 4300, 4483, 4574, 6193, 6468, 6651, 7459, 8466]) = d1(1)^2+d1(2)^2;
	M([6970, 7153, 7244, 7427, 7518, 7573, 7848, 8031, 8214, 8397, 8488, 8563, 8742]) = -glab(5);
	M([1088, 1179, 1546, 1637, 1820, 2279, 2613, 2704, 2795, 2886, 3253, 3344, 3527, 3986, 4884, 6903]) = 1;
	M([1548, 1639, 2006, 2097, 2280, 2463, 3073, 3164, 3255, 3346, 3713, 3804, 3987, 4262, 7179]) = -1;
	M([1824, 1915, 2282, 2373, 3349, 3440, 3531, 3622, 3989, 4080, 4171, 4446, 7363]) = -1;
	M([2284, 2375, 2466, 3809, 3900, 3991, 4082, 4265, 4356, 4447, 4538, 7455]) = 1;
	M([2836, 2927, 3294, 3385, 3568, 4027, 5097, 5188, 5279, 5370, 5737, 5828, 6011, 6470, 6908, 7823]) = c1(2)*a1(2)+c1(1)*a1(1);
	M([3296, 3387, 3754, 3845, 4028, 4303, 5557, 5648, 5739, 5830, 6197, 6288, 6471, 7184, 8191]) = -a1(1)*d1(1)-a1(2)*d1(2);
	M([3572, 3663, 4030, 4121, 4212, 4487, 5833, 5924, 6015, 6106, 6473, 6564, 6655, 7368, 8375]) = -c1(1)*d1(1)-c1(2)*d1(2);
	M([4032, 4123, 4306, 4397, 4488, 4579, 6293, 6384, 6475, 6566, 7460, 8467]) = d1(1)^2+d1(2)^2;
	M([6976, 7067, 7250, 7341, 7432, 7523, 7673, 7764, 7855, 7946, 8221, 8312, 8403, 8494, 8564, 8743]) = -1/2*glab(3)-1/2*glab(6)+1/2*glab(2);
	M([1277, 1644, 1735, 1918, 2377, 2621, 2712, 2895, 2986, 3353, 3444, 3627, 4086, 4977, 6996]) = 1;
	M([1737, 2104, 2195, 2378, 3081, 3172, 3355, 3446, 3813, 3904, 4087, 4362, 7272]) = -1;
	M([1921, 2288, 2379, 3265, 3356, 3539, 3630, 3997, 4088, 4179, 4454, 7364]) = -1;
	M([2381, 2472, 3725, 3816, 3999, 4090, 4273, 4364, 4455, 4546, 7456]) = 1;
	M([3025, 3392, 3483, 3666, 4125, 5105, 5196, 5379, 5470, 5837, 5928, 6111, 6570, 7001, 7916]) = c1(2)*b1(2)+c1(1)*b1(1);
	M([3485, 3852, 3943, 4126, 4401, 5565, 5656, 5839, 5930, 6297, 6388, 6571, 7277, 8284]) = -d1(2)*b1(2)-d1(1)*b1(1);
	M([3669, 4036, 4127, 4218, 4493, 5749, 5840, 6023, 6114, 6481, 6572, 6663, 7369, 8376]) = -c1(1)*d1(1)-c1(2)*d1(2);
	M([4129, 4312, 4403, 4494, 4585, 6209, 6300, 6483, 6574, 7461, 8468]) = d1(1)^2+d1(2)^2;
	M([7073, 7256, 7347, 7438, 7529, 7589, 7680, 7863, 7954, 8229, 8320, 8411, 8502, 8565, 8744]) = -1/2*glab(6)-1/2*glab(5)+1/2*glab(4);
	M([2811, 2902, 2993, 3544, 3635, 4186, 7089]) = 1;
	M([3271, 3362, 3453, 4004, 4095, 4462, 7365]) = -2;
	M([3731, 3822, 3913, 4280, 4371, 4554, 7457]) = 1;
	M([5295, 5386, 5477, 6028, 6119, 6670, 8009]) = c1(2)^2+c1(1)^2;
	M([5755, 5846, 5937, 6488, 6579, 8377]) = -2*c1(1)*d1(1)-2*c1(2)*d1(2);
	M([6215, 6306, 6397, 8469]) = d1(1)^2+d1(2)^2;
	M([7595, 7686, 7777, 8236, 8327, 8510, 8745]) = -glab(6);

	Mr = rref(M);  % replace me with a MEX

	A = zeros(4);
	amcols = [96 95 94 89];
	A(1, 2) = 1;
	A(2, :) = -Mr(92, amcols);
	A(3, 4) = 1;
	A(4, :) = -Mr(82, amcols);

	% generated for action variable 'zd'
	% action matrix monomials: 1 zd f f*zd
	[V D] = eig(A);
	sol =  V([3, 2],:)./(ones(2, 1)*V(1,:));

	if (find(isnan(sol(:))) > 0)
		
		f = [];
		za = [];
		zb = [];
		zc = [];
		zd = [];
	else
		
		
		ev  = diag(D);
		I = find(not(imag( sol(1,:) )) & not(imag( ev ))');
		f = sol(1,I);
		zd = sol(2,I);
        cnt = size(f,2);
		zc = -(repmat(Mr(end-1, end), 1, cnt) - f*Mr(end-1, end-1)) ./ zd;
		zb = -(repmat(Mr(end-2, end), 1, cnt) - f*Mr(end-2, end-1)) ./ zd;
		za = -(repmat(Mr(end-3, end), 1, cnt) - f*Mr(end-3, end-1)) ./ zd;        
	end
end
